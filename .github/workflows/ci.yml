name: CI

on:
    push:

jobs:
    ci:
        name: Restore, Build, Update
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Cache Deps
              id: cache-deps
              uses: actions/cache@v3
              with:
                  path: ~/.nuget/packages
                  key: ${{ runner.os }}-nuget-${{ hashFiles('**/packages.lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-nuget-

            - name: Prepare .net
              uses: actions/setup-dotnet@v3
              with:
                  dotnet-version: 7

            - name: Restore deps
              run: >
                  dotnet restore
                  --locked-mode

            - name: Build
              run: >
                  dotnet build
                  --configuration Release
                  --no-restore

            - name: Test
              run: >
                  dotnet test
                  --no-restore
                  --verbosity normal
